# This pipeline publishes the `@kth/canvas-api` package to npm
pr: none
trigger: none

variables:
  - group: elarande-general-params

resources:
  repositories:
    - repository: stratus-templates
      type: git
      name: Cloud Excellence Team/stratus-templates
      ref: main

extends:
  template: templates/security/security-scans.yml@stratus-templates
  parameters:
    break: false
    steps:
      - checkout: self
        path: github

      - task: NodeTool@0
        inputs:
          versionSource: "spec"
          versionSpec: 20.x

      - task: Npm@1
        displayName: Run `npm ci` for `@kth/style`
        inputs:
          workingDir: "$(Pipeline.Workspace)/github/@kth/style"
          command: ci

      - task: Npm@1
        displayName: Run `npm run build` for `@kth/style`
        inputs:
          workingDir: "$(Pipeline.Workspace)/github/@kth/style"
          command: custom
          customCommand: run build

      - task: Npm@1
        displayName: Run `npm test` for `@kth/style`
        inputs:
          workingDir: "$(Pipeline.Workspace)/github/@kth/style"
          command: custom
          customCommand: test

      - task: Npm@1
        displayName: Publish `@kth/style` to npm
        inputs:
          workingDir: "$(Pipeline.Workspace)/github/@kth/style"
          command: publish
          publishRegistry: useExternalRegistry
          publishEndpoint: $(npmServiceConnection)
